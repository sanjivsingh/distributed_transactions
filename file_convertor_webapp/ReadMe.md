# File Converter WebApp

A FastAPI-based web application for converting files between various formats (JSON, CSV, Parquet, XML, YAML). It supports asynchronous processing, database storage of conversion requests, SHA-256 hashing for duplicate detection, and file editing capabilities.

## Features

- **File Conversion**: Convert between JSON, CSV, Parquet, XML, and YAML formats
- **Asynchronous Processing**: Background worker for handling conversions
- **Database Integration**: SQLite database for storing conversion requests
- **Duplicate Detection**: SHA-256 hashing to prevent duplicate conversions
- **File Management**: Upload, view, edit, and download converted files
- **Validation**: Client-side and server-side validation for file formats
- **RESTful API**: Clean API endpoints for all operations

## Installation

1. **Clone the repository** (if applicable) and navigate to the project root.

2. **Install dependencies**:
   ```bash
   pip install -r requirements.txt
   ```

3. **Initialize the database**:
   The app automatically initializes the database on startup. If you need to reset:
   - Modify `init_db(reset=True)` in `ConverterWebApp.py` for a fresh start.

4. **Run the application**:
   ```bash
   python -m file_convertor_webapp.ConverterWebApp
   ```
   Or use uvicorn:
   ```bash
   uvicorn file_convertor_webapp.ConverterWebApp:app --reload

   .venv/bin/python -m uvicorn file_convertor_webapp.ConverterWebApp:app --reload --port 8000
   ```

5. **Run the worker** (for asynchronous conversions):
   ```bash
   .venv/bin/python -m file_convertor_webapp.worker
   ```

## Usage

### Web Interface

1. Open your browser to `http://localhost:8000` (default port).
2. Upload a file and select input/output formats.
3. Submit the form to start conversion.
4. Check status, view, edit, or download the result.

### API Endpoints

#### GET /
Returns the main upload form.

#### POST /add
Upload and initiate file conversion.
- **Parameters** (form data):
  - `file`: The file to convert
  - `input_format`: Input format (must match file extension)
  - `output_format`: Desired output format
- **Response**: HTML page with request ID and status link.

#### GET /supported_formats
Returns a JSON list of supported formats.
- **Response**: `{"formats": ["JSON", "CSV", "PARQUET", "XML", "YAML"]}`

#### GET /list
Lists all conversion requests in a table.
- **Response**: HTML table with request details.

#### GET /status/{request_num}
Checks the status of a conversion request.
- **Parameters**: `request_num` (integer)
- **Response**: HTML page with request status.

#### GET /download/{request_num}
Downloads the converted file.
- **Parameters**: `request_num` (integer)
- **Response**: File download.

#### GET /view/{request_num}
Views the converted file content in the browser.
- **Parameters**: `request_num` (integer)
- **Response**: HTML page with file content.

#### GET /edit/{request_num}
Edits the converted file content.
- **Parameters**: `request_num` (integer)
- **Response**: HTML form for editing.

#### POST /save/{request_num}
Saves edited file content.
- **Parameters**: `request_num` (integer), `content` (form data)
- **Response**: HTML confirmation.

## Database Schema

### ConversionRequest
- `id`: Unique request ID (generated by Snowflake)
- `filename`: Original filename
- `input_format`: Input file format
- `output_format`: Output file format
- `upload_path`: Path to uploaded file
- `converted_path`: Path to converted file
- `status`: Request status ("pending", "running", "completed", "failed")
- `details`: Additional details or error messages
- `file_hash`: SHA-256 hash of the input file

## Worker Process

The `worker.py` script runs in the background to process pending conversions:

- Polls the database for "pending" requests
- Updates status to "running"
- Performs the conversion using the file_convertor module
- Updates status to "completed" or "failed"

Run the worker separately from the web app.

## File Structure

```
file_convertor_webapp/
├── ConverterWebApp.py    # Main FastAPI app
├── database.py           # Database operations
├── models.py             # SQLAlchemy models
├── worker.py             # Background worker
├── ReadMe.md             # This file
├── __init__.py
└── __pycache__/
```

## Dependencies

- fastapi
- uvicorn
- sqlalchemy
- pydantic
- pyarrow (for Parquet)
- pyyaml (for YAML)
- Other dependencies as listed in requirements.txt

## Validation

- **Input format must match file extension**
- **Input and output formats cannot be the same**
- **File must be selected**

Validation is performed both client-side (JavaScript) and server-side.

## Error Handling

- Invalid requests return appropriate HTML error pages
- Database errors are logged and handled gracefully
- File operations include try-catch blocks

## Security Considerations

- File uploads are limited to supported formats
- SHA-256 hashing prevents duplicate processing
- No authentication implemented (add as needed for production)

## Contributing

1. Fork the repository
2. Create a feature branch
3. Make changes and test
4. Submit a pull request

## License

[Add license information here]
